<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.module.category" id="jidokaacademy">
        <field name="name">Jidoka Academy</field>
    </record>
    <record id="jidokaacademy_manager" model="res.groups">
        <field name="name">Manager</field>
        <field name="category_id" ref="jidokaacademy.jidokaacademy"></field>
    </record>
    <record id="jidokaacademy_user" model="res.groups">
        <field name="name">User</field>
        <field name="category_id" ref="jidokaacademy.jidokaacademy"></field>
    </record>
    <record id="only_responsible_can_modify" model="ir.rule">
        <field name="name">Only Responsible Can Modify</field>
        <field name="model_id" ref="jidokaacademy.model_jidokaacademy_course"></field>
        <field name="groups" eval="[(4, ref('jidokaacademy.jidokaacademy_manager'))]"></field>
        <field name="perm_read" eval="0"></field>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1" />
        <field name="domain_force">['|',('user_id','=',user.id), ('user_id','=',False)]</field>
    </record>
    
    <record id="partner_form_inherit" model="ir.ui.view">
        <field name="name">res.partner.inherit.view.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <field name="vat" position= "after">
                <field name="is_instructor"/>
            </field>
        </field>
    </record>

    <record id="jidokaacademy.course_view_form" model="ir.ui.view">
        <field name="name">jidokaacademy.course.view.form</field>
        <field name="model">jidokaacademy.course</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <field name="name"></field>
                        <field name="user_id"></field>
                    </group>
                    <notebook>
                        <page string="Description" name="description">
                            <field name="description"></field>
                        </page>
                        <page string="Session" name="session">
                            <field name="session_ids"></field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="jidokaacademy.course_view_tree" model="ir.ui.view">
        <field name="name">jidokaacademy.course.view.tree</field>
        <field name="model">jidokaacademy.course</field>
        <field name="arch" type="xml">
            <tree string="">
                <field name="name"></field>
                <field name="user_id"></field>
                <field name="description"></field>
            </tree>
        </field>
    </record>
    <record id="jidokaacademy.course_view_search" model="ir.ui.view">
        <field name="name">jidokaacademy.course.view.search</field>
        <field name="model">jidokaacademy.course</field>
        <field name="arch" type="xml">
            <search string="Search Description">
                <field name="name"></field>
                <field name="description"></field>
                    <filter name="my_course" string="My Course"
                        domain="[('user_id', '=', uid)]"/>advanced view
                    <group string="Group By">
                        <filter name="group_by_user" string="Responsible"
                            context="{'group_by': 'user_id'}"/>
                    </group> 
            </search>
        </field>
    </record>
    <record id="jidokaacademy.course_action" model="ir.actions.act_window">
        <field name="name">Course</field>
        <field name="res_model">jidokaacademy.course</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_my_course': 1,}</field>
    </record>
    <menuitem
        id="jidokaacademy_menu_root"
        name="Jidoka Academy"
        sequence="20"
        web_icon="jidokaacademy,data/icons8-academy-64.png"/>
    <menuitem
        id="course_menu_act"
        name="Course"
        parent = "jidokaacademy_menu_root"
        action = "jidokaacademy.course_action"
        sequence="10"/>
	
	<record id="jidokaacademy.session_view_form" model="ir.ui.view">
		<field name="name">jidokaacademy.session.view.form</field>
		<field name="model">jidokaacademy.session</field>
		<field name="arch" type="xml">
			<form string="">
				<header> 
					<button id="button_confirm" name="action_confirm" string="Confirm" class="oe_highlight"
							states="draft" type="object"/>
					<button id="button_done" name="action_done" string="Mark as Done" class="btn-primary"
							states="confirm" type="object"/>
					<button id="button_draft" name="action_draft" string="Save as Draft" class="btn-primary"
							states="cancel" type="object"/>
					<button id="button_cancel" name="action_cancel" string="Cancel" class="btn-danger"
							states="draft,done,confirm" type="object" confirm="Are you sure to cancel?"/>
					<field name="state" widget="statusbar" statusbar_visible="draft,done,confirm"/>
				</header>
				<sheet> 
					<field name="image" widget="image" class="oe_avatar"/>
					<group>
						<group>
							<field name="name" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							<field name="partner_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							<field name="course_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							<field name="active" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
						</group>
						<group>
							<field name="number_of_seats" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							<field name="duration" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
							<field name="start_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="taken_seats" widget="progressbar"/>
						</group>
					</group>
					<notebook>
						<page string="Description" name="description">
							<field name="description" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
						</page>
						<page string="Attendees" name="partner_ids">
							<field name="partner_ids" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
						</page>
					</notebook>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers"/>
					<field name="message_ids" widget="mail_thread"/>
				</div>
			</form>
		</field>
	</record>
    <record id="jidokaacademy.session_view_tree" model="ir.ui.view">
		<field name="name">jidokaacademy.session.view.tree</field>
		<field name="model">jidokaacademy.session</field>
		<field name="arch" type="xml">
			<tree decoration-info="duration &lt; 5" decoration-danger="duration &gt; 15">
				<field name="name"/>
				<field name="start_date"/>
				<field name="number_of_seats"/>
				<field name="taken_seats" widget="progressbar"/>
				<field name="partner_id" />
				<field name="course_id"/> 
				<field name="duration"/>
				<field name="state"/>
			</tree>
		</field>
	</record>
	<record id="jidokaacademy.session_view_calendar" model="ir.ui.view">
        <field name="name">jidokaacademy.session.view.calendar</field>
        <field name="model">jidokaacademy.session</field>
        <field name="arch" type="xml">
            <calendar string="Calendar Description" date_start="start_date" color="course_id">
                <field name="name"></field>
            </calendar>
        </field>
    </record>
    <record id="jidokaacademy.session_view_graph" model="ir.ui.view">
        <field name="name">jidokaacademy.session.view.graph</field>
        <field name="model">jidokaacademy.session</field>
        <field name="arch" type="xml">
            <graph string="Graph Description" >
                <field name="course_id"/>
                <field name="number_of_attendees" type="measure"/>
            </graph>
        </field>
    </record>
	<record id="jidokaacademy.session_view_kanban" model="ir.ui.view">
        <field name="name">jidokaacademy.session.view.kanban</field>
        <field name="model">jidokaacademy.session</field>
        <field name="arch" type="xml">
            <kanban string="Kanban Description" default_group_by="course_id">
                <field name="id"/>
                <field name="name"/>
                <field name="start_date"/>
                <field name="duration"/>
                <field name="number_of_seats"/>
                <field name="partner_id"/>
                <field name="course_id"/>
                <field name="taken_seats"/>
                <field name="active"/>
                
                <templates>
					<t t-name="kanban-box">
						<div t-attf-class="oe_kanban_card oe_kanban_global_click"> 
							<div class="o_kanban_record_top mb16">
								<div class="o_kanban_record_headings mt4">
									<strong class="o_kanban_record_title"><strong><t t-esc="record.name.value"/></strong></strong>
								</div>
								<strong><field name="number_of_seats"/></strong>
							</div>
							<div class="o_kanban_record_bottom">
								<div class="oe_kanban_bottom_left_text-muted">
									<span><t t-esc="record.course_id.value"/> <t t-esc="record.start_date.value"/></span>
								</div>
								<div class="oe_kanban_bottom_right">
									<field name="taken_seats" widget="progressbar"/>
								</div>
							</div>
						</div>
					</t>
				</templates>
            </kanban>
        </field>
    </record>
    <record id="jidokaacademy.session_action" model="ir.actions.act_window">
        <field name="name">Session</field>
        <field name="res_model">jidokaacademy.session</field>
        <field name="view_mode">tree,form,calendar,graph,kanban</field>
    </record>
    <menuitem
        id="session_menu_act"
        name="Session"
        parent="jidokaacademy_menu_root"
        action="jidokaacademy.session_action"
        sequence="20"/>

    <record id="wizard_attendees_view_form" model="ir.ui.view">
		<field name="name">wizard.attendees.view.form</field>
		<field name="model">wizard.attendees</field>
		<field name="arch" type="xml">
			<form string="">
				<sheet>
					<group>
						<field name="session_id"/>
						<field name="partner_ids"/>
					</group>
					<footer>
						<button name='process' type='object' class='btn btn-success' string='Confirm'/>
						<button special='cancel' class='btn btn-danger' string='Cancel'/>
					</footer>
				</sheet>
			</form>
		</field>
	</record>

    <record id="wizard_attendees_action" model="ir.actions.act_window">
        <field name="name">Wizard Add Attendees</field>
        <field name="res_model">wizard.attendees</field>
        <field name="view_mode">form</field>
		<field name="context">{'default_session_id':active_id}</field>
		<field name="target">new</field>
		<field name="binding_model_id" ref="model_jidokaacademy_session"></field>
    </record>
    
</odoo>